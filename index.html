<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Widget</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/geist-font/1.0.0/fonts/geist-sans/style.min.css">
    <style>
        /* Chat Widget Styling */
        #chat-widget-container {
            position: fixed !important;
            bottom: 20px !important;
            right: 20px !important;
            width: 350px !important;
            height: 500px !important;
            background: white !important;
            border-radius: 12px !important;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1) !important;
            display: none !important;
            flex-direction: column !important;
            z-index: 999999 !important;
            overflow: hidden !important;
            font-family: 'Geist Sans', -apple-system, BlinkMacSystemFont, system-ui, sans-serif !important;
        }

        #chat-widget-header {
            background: #854fff !important;
            color: white !important;
            padding: 16px 20px !important;
            font-weight: bold !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            font-size: 18px !important;
        }

        .header-content {
            display: flex !important;
            flex-direction: column !important;
            gap: 4px !important;
        }

        .header-title {
            font-size: 18px !important;
            font-weight: bold !important;
        }

        .online-status {
            display: flex !important;
            align-items: center !important;
            gap: 6px !important;
            font-size: 12px !important;
            font-weight: normal !important;
            opacity: 0.9 !important;
        }

        .status-dot {
            width: 8px !important;
            height: 8px !important;
            background: #4ade80 !important;
            border-radius: 50% !important;
            animation: pulse 2s infinite !important;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        #chat-widget-header button {
            background: none !important;
            border: none !important;
            color: white !important;
            font-size: 20px !important;
            cursor: pointer !important;
            padding: 0 !important;
            width: 24px !important;
            height: 24px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        #chat-widget-body {
            flex: 1 !important;
            padding: 20px !important;
            overflow-y: auto !important;
            display: flex !important;
            flex-direction: column !important;
            gap: 12px !important;
        }

        /* Message bubble styling */
        .message-container {
            display: flex !important;
            gap: 8px !important;
            align-items: flex-end !important;
        }

        .message-container.user {
            flex-direction: row-reverse !important;
        }

        .message-avatar {
            width: 28px !important;
            height: 28px !important;
            border-radius: 50% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 16px !important;
            flex-shrink: 0 !important;
            background: white !important;
        }

        .message-bubble {
            max-width: 75% !important;
            padding: 10px 14px !important;
            border-radius: 18px !important;
            font-size: 14px !important;
            word-wrap: break-word !important;
            line-height: 1.4 !important;
            animation: fadeIn 0.3s ease-in !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-message {
            background: #854fff !important;
            color: white !important;
            border-bottom-right-radius: 4px !important;
        }

        .bot-message {
            background: #f1f1f1 !important;
            color: #333 !important;
            border-bottom-left-radius: 4px !important;
        }

        .welcome-message {
            background: #f1f1f1 !important;
            color: #333 !important;
            border-bottom-left-radius: 4px !important;
            font-weight: 500 !important;
        }

        /* Thinking indicator */
        .thinking-container {
            display: flex !important;
            gap: 8px !important;
            align-items: flex-end !important;
        }

        .thinking-indicator {
            padding: 10px 14px !important;
            border-radius: 18px !important;
            background: #f1f1f1 !important;
            border-bottom-left-radius: 4px !important;
            display: flex !important;
            gap: 4px !important;
            align-items: center !important;
        }

        .thinking-dot {
            width: 8px !important;
            height: 8px !important;
            border-radius: 50% !important;
            background: #999 !important;
            animation: bounce 1.4s infinite ease-in-out !important;
        }

        .thinking-dot:nth-child(1) {
            animation-delay: -0.32s !important;
        }

        .thinking-dot:nth-child(2) {
            animation-delay: -0.16s !important;
        }

        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        #chat-widget-footer {
            padding: 12px !important;
            display: flex !important;
            flex-direction: column !important;
            gap: 8px !important;
        }

        /* Quick reply shortcuts */
        .quick-replies {
            display: flex !important;
            gap: 8px !important;
            flex-wrap: wrap !important;
            padding-bottom: 4px !important;
            justify-content: center !important;
        }

        .quick-reply-btn {
            background: white !important;
            border: 1px solid #ddd !important;
            color: #333 !important;
            padding: 8px 16px !important;
            border-radius: 20px !important;
            font-size: 13px !important;
            cursor: pointer !important;
            transition: all 0.2s !important;
            white-space: nowrap !important;
            font-weight: 400 !important;
        }

        .quick-reply-btn:hover {
            background: #f5f5f5 !important;
            border-color: #854fff !important;
            color: #854fff !important;
        }

        .input-row {
            display: flex !important;
            gap: 10px !important;
        }

        #chat-widget-input {
            flex: 1 !important;
            padding: 10px 12px !important;
            border: 1px solid #ddd !important;
            border-radius: 20px !important;
            outline: none !important;
            font-size: 14px !important;
        }

        #chat-widget-input:focus {
            border-color: #854fff !important;
        }

        #chat-widget-send {
            background: #854fff !important;
            color: white !important;
            border: none !important;
            padding: 10px 20px !important;
            border-radius: 20px !important;
            cursor: pointer !important;
            font-weight: 500 !important;
            transition: background 0.2s !important;
        }

        #chat-widget-send:hover {
            background: #6b3fd4 !important;
        }

        /* Powered by branding */
        .powered-by {
            text-align: center !important;
            font-size: 11px !important;
            color: #999 !important;
            padding-bottom: 4px !important;
        }

        .powered-by a {
            color: #854fff !important;
            text-decoration: none !important;
            font-weight: 600 !important;
        }

        .powered-by a:hover {
            text-decoration: underline !important;
        }

        /* Chat bubble button */
        #chat-widget-button {
            position: fixed !important;
            bottom: 20px !important;
            right: 20px !important;
            background: #854fff !important;
            color: white !important;
            border: none !important;
            width: 60px !important;
            height: 60px !important;
            border-radius: 50% !important;
            cursor: pointer !important;
            font-size: 24px !important;
            z-index: 999999 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            box-shadow: 0 4px 12px rgba(133, 79, 255, 0.4) !important;
            transition: transform 0.2s, box-shadow 0.2s !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        #chat-widget-button:hover {
            transform: scale(1.05) !important;
            box-shadow: 0 6px 16px rgba(133, 79, 255, 0.5) !important;
        }

        #chat-widget-button:hover .tooltip {
            opacity: 1 !important;
            visibility: visible !important;
        }

        /* Tooltip styling */
        .tooltip {
            position: absolute !important;
            bottom: 70px !important;
            right: 0 !important;
            background: white !important;
            color: #333 !important;
            padding: 12px 16px !important;
            border-radius: 12px !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            font-size: 14px !important;
            font-family: 'Geist Sans', -apple-system, BlinkMacSystemFont, system-ui, sans-serif !important;
            white-space: nowrap !important;
            opacity: 0 !important;
            visibility: hidden !important;
            transition: opacity 0.3s, visibility 0.3s !important;
            z-index: 999998 !important;
            pointer-events: none !important;
        }

        .tooltip::after {
            content: '' !important;
            position: absolute !important;
            bottom: -6px !important;
            right: 20px !important;
            width: 12px !important;
            height: 12px !important;
            background: white !important;
            transform: rotate(45deg) !important;
            box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1) !important;
        }
    </style>
</head>
<body>

    <!-- Chat Widget Button -->
    <button id="chat-widget-button">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="pointer-events: none;">
            <path d="M12 2C6.48 2 2 6.48 2 12C2 13.54 2.38 14.99 3.06 16.26L2 22L7.74 20.94C9.01 21.62 10.46 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z" fill="white"/>
        </svg>
        <div class="tooltip">Hi üëã if you need some help you can find me here!</div>
    </button>

    <!-- Chat Widget -->
    <div id="chat-widget-container">
        <div id="chat-widget-header">
            <div class="header-content">
                <div class="header-title">Chat</div>
                <div class="online-status">
                    <span class="status-dot"></span>
                    <span>Online</span>
                </div>
            </div>
            <button onclick="window.closeChatWidget && window.closeChatWidget()">‚úñ</button>
        </div>
        <div id="chat-widget-body">
            <div class="message-container">
                <div class="message-avatar">ü§ñ</div>
                <div class="message-bubble welcome-message">
                    <strong>Hi üëã, how can we help?</strong>
                </div>
            </div>
        </div>
        <div id="chat-widget-footer">
            <div class="quick-replies">
                <button class="quick-reply-btn" data-message="I would like to know about your pricing">üí∞ Pricing</button>
                <button class="quick-reply-btn" data-message="Can you tell me about your products?">üì¶ Product Info</button>
                <button class="quick-reply-btn" data-message="I need to contact customer support">üìû Contact Us</button>
                <button class="quick-reply-btn" data-message="I want to track my order">üìç Track my order</button>
            </div>
            <div class="input-row">
                <input type="text" id="chat-widget-input" placeholder="Type your message here...">
                <button id="chat-widget-send">Send</button>
            </div>
            <div class="powered-by">
                Powered by <a href="https://machineovic.com" target="_blank">Machineovic</a>
            </div>
        </div>
    </div>

    <!-- Chat Widget Script -->
    <script>
        // Wait for DOM to be fully loaded
        (function() {
            'use strict';

            // Configuration
            window.ChatWidgetConfig = {
                webhook: {
                    url: 'https://n8n.srv1186643.hstgr.cloud/webhook/85a6031b-3376-4fc7-b68f-ddb7d900d3c6/chat',
                    route: 'general'
                },
                style: {
                    primaryColor: '#854fff',
                    secondaryColor: '#6b3fd4',
                    position: 'right',
                    backgroundColor: '#ffffff',
                    fontColor: '#333333'
                }
            };

            // Function to generate or retrieve a unique chat ID
            function getChatId() {
                let chatId = sessionStorage.getItem("chatId");
                if (!chatId) {
                    chatId = "chat_" + Math.random().toString(36).substr(2, 9);
                    sessionStorage.setItem("chatId", chatId);
                }
                return chatId;
            }

            // Initialize when DOM is ready
            function initializeChatWidget() {
                var chatButton = document.getElementById("chat-widget-button");
                var chatContainer = document.getElementById("chat-widget-container");
                var chatInput = document.getElementById("chat-widget-input");
                var sendBtn = document.getElementById("chat-widget-send");
                var chatBody = document.getElementById("chat-widget-body");
                var quickReplyButtons = document.querySelectorAll(".quick-reply-btn");

                // Verify all elements exist
                if (!chatButton || !chatContainer || !chatInput || !sendBtn || !chatBody) {
                    console.error("Chat widget elements not found. Retrying...");
                    return false;
                }

                // Show chat widget and hide bubble
                var openChat = function() {
                    chatContainer.style.display = "flex";
                    chatButton.style.display = "none";
                };

                // Close chat widget and show bubble
                window.closeChatWidget = function() {
                    chatContainer.style.display = "none";
                    chatButton.style.display = "flex";
                };

                // Show thinking indicator
                function showThinking() {
                    var thinkingContainer = document.createElement("div");
                    thinkingContainer.className = "thinking-container";
                    thinkingContainer.id = "thinking-bubble";
                    thinkingContainer.innerHTML = `
                        <div class="message-avatar">ü§ñ</div>
                        <div class="thinking-indicator">
                            <div class="thinking-dot"></div>
                            <div class="thinking-dot"></div>
                            <div class="thinking-dot"></div>
                        </div>
                    `;
                    chatBody.appendChild(thinkingContainer);
                    chatBody.scrollTop = chatBody.scrollHeight;
                }

                // Remove thinking indicator
                function hideThinking() {
                    var thinkingBubble = document.getElementById("thinking-bubble");
                    if (thinkingBubble) {
                        thinkingBubble.remove();
                    }
                }

                // Send message function
                function sendMessage() {
                    var message = chatInput.value;
                    if (message.trim() === "") return;

                    // Add user message bubble with avatar
                    var userContainer = document.createElement("div");
                    userContainer.className = "message-container user";
                    userContainer.innerHTML = `
                        <div class="message-avatar">üë§</div>
                        <div class="message-bubble user-message">${message}</div>
                    `;
                    chatBody.appendChild(userContainer);
                    chatBody.scrollTop = chatBody.scrollHeight;

                    // Clear input
                    chatInput.value = "";

                    // Show thinking indicator
                    showThinking();

                    var chatId = getChatId();

                    fetch(window.ChatWidgetConfig.webhook.url, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            chatId: chatId,
                            message: message,
                            route: window.ChatWidgetConfig.webhook.route
                        })
                    })
                    .then(function(response) { return response.json(); })
                    .then(function(data) {
                        hideThinking();

                        var botContainer = document.createElement("div");
                        botContainer.className = "message-container";
                        botContainer.innerHTML = `
                            <div class="message-avatar">ü§ñ</div>
                            <div class="message-bubble bot-message">${data.output || "Sorry, I couldn't understand that."}</div>
                        `;
                        chatBody.appendChild(botContainer);
                        chatBody.scrollTop = chatBody.scrollHeight;
                    })
                    .catch(function(error) {
                        console.error("Error:", error);
                        hideThinking();

                        var errorContainer = document.createElement("div");
                        errorContainer.className = "message-container";
                        errorContainer.innerHTML = `
                            <div class="message-avatar">ü§ñ</div>
                            <div class="message-bubble bot-message">Sorry, something went wrong. Please try again.</div>
                        `;
                        chatBody.appendChild(errorContainer);
                        chatBody.scrollTop = chatBody.scrollHeight;
                    });
                }

                // Handle quick reply button clicks
                function sendQuickReply(message) {
                    chatInput.value = message;
                    sendMessage();
                }

                // Attach event listeners
                chatButton.onclick = openChat;
                sendBtn.onclick = sendMessage;
                chatInput.onkeypress = function(e) {
                    if (e.key === "Enter") {
                        sendMessage();
                    }
                };

                // Attach quick reply listeners
                quickReplyButtons.forEach(function(btn) {
                    btn.onclick = function() {
                        var message = this.getAttribute('data-message');
                        sendQuickReply(message);
                    };
                });

                console.log("‚úÖ Chat widget initialized successfully");
                return true;
            }

            // Try to initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    var initialized = initializeChatWidget();
                    if (!initialized) {
                        // Retry after a short delay if initialization failed
                        setTimeout(initializeChatWidget, 500);
                    }
                });
            } else {
                // DOM is already ready
                var initialized = initializeChatWidget();
                if (!initialized) {
                    // Retry after a short delay if initialization failed
                    setTimeout(initializeChatWidget, 500);
                }
            }
        })();
    </script>

</body>
</html>
